---
import { getCollection, type CollectionEntry } from 'astro:content';
import Base from '../../layouts/Base.astro';

export async function getStaticPaths() {
  const photos = await getCollection('photos');
  return photos.map((photo) => ({
    params: { slug: photo.slug },
    props: photo,
  }));
}

type Props = CollectionEntry<'photos'>;

const photo = Astro.props;
const { Content } = await photo.render();

const formattedDate = photo.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Base title={`${photo.data.title} - Rhys Sullivan`} description={photo.data.alt} wide>
  <article>
    <a href="/photos" class="text-sm text-[var(--text-muted)] hover:text-[var(--text)] transition-colors mb-6 inline-block">
      &larr; back to space
    </a>
    
    <div class="mb-8 -mx-6 sm:mx-0">
      <img
        src={photo.data.src}
        alt={photo.data.alt}
        class="w-full sm:rounded-lg max-h-[80vh] object-contain bg-black"
      />
    </div>

    <header class="mb-6 max-w-2xl">
      <h1 class="text-2xl font-semibold tracking-tight">{photo.data.title}</h1>
      <time class="text-sm text-[var(--text-muted)]">{formattedDate}</time>
    </header>

    <div class="prose max-w-2xl">
      <Content />
    </div>
  </article>
</Base>
